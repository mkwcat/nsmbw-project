#pragma once

#include "iterator"
#include "utility"

namespace std
{

template <class T>
constexpr inline const T& min(const T& l, const T& r)
{
    return (r < l) ? r : l;
}

template <class T>
constexpr inline const T& max(const T& l, const T& r)
{
    return (l < r) ? r : l;
}

template <class T>
constexpr inline const T& clamp(const T& v, const T& lo, const T& hi)
{
    return (v < lo) ? lo : (hi < v) ? hi : v;
}

template <class T, class Compare>
constexpr inline const T& clamp(const T& v, const T& lo, const T& hi, Compare comp)
{
    return comp(v, lo) ? lo : comp(hi, v) ? hi : v;
}

template <class Iterator, class Compare>
constexpr inline void sort(Iterator begin, Iterator end, Compare comp)
{
    auto partition = [](Iterator begin, Iterator end, Compare comp) {
        auto pivot = *end;
        auto sortedIndex = begin;

        for (auto i = begin; i < end; ++i) {
            if (comp(*i, pivot)) {
                swap(*sortedIndex++, *i);
            }
        }

        swap(*sortedIndex, *end);
        return sortedIndex;
    };

    if (begin >= end) {
        return;
    }

    auto pivot = partition(begin, end - 1, comp);

    sort(begin, pivot, comp);
    sort(pivot + 1, end, comp);
}

template <class Iterator>
constexpr inline void sort(Iterator begin, Iterator end)
{
    sort(begin, end, [](auto l, auto r) { return l < r; });
}

template <class InputIt, class T>
constexpr std::ptrdiff_t count(InputIt first, InputIt last, const T& value)
{
    std::ptrdiff_t count = 0;
    for (; first != last; first++) {
        if (*first == value) {
            count++;
        }
    }
    return count;
}

template <class InputIt1, class InputIt2>
constexpr bool equal(InputIt1 first1, InputIt1 last1, InputIt2 first2)
{
    for (; first1 != last1; first1++, first2++) {
        if (!(*first1 == *first2)) {
            return false;
        }
    }
    return true;
}

template <class InputIt, class T>
constexpr InputIt find(InputIt first, InputIt last, const T& value)
{
    for (; first != last; first++) {
        if (*first == value) {
            return first;
        }
    }
    return last;
}

} // namespace std
